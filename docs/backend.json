
{
  "entities": {
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the item."
        },
        "itemName": {
          "type": "string",
          "description": "The name of the item."
        },
        "category": {
          "type": "string",
          "description": "The category of the item (Aluminium, Glass, Accessories)."
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the item in stock."
        },
        "unit": {
          "type": "string",
          "description": "The unit of measurement for the item (Kg, Feet, Piece)."
        },
        "purchasePrice": {
          "type": "number",
          "description": "The purchase price of the item."
        },
        "salePrice": {
          "type": "number",
          "description": "The sale price of the item."
        },
        "thickness": {
          "type": "string",
          "description": "The thickness of the item."
        }
      },
      "required": [
        "id",
        "itemName",
        "category",
        "quantity",
        "unit",
        "purchasePrice",
        "salePrice"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "customerName": {
          "type": "string",
          "description": "The name of the customer."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "The address of the customer."
        },
        "openingBalance": {
          "type": "number",
          "description": "The customer's opening balance."
        },
        "balanceType": {
          "type": "string",
          "enum": [
            "debit",
            "credit"
          ],
          "description": "The type of opening balance (debit or credit)."
        }
      },
      "required": [
        "id",
        "customerName",
        "phoneNumber",
        "address"
      ]
    },
    "Vendor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vendor",
      "type": "object",
      "description": "Represents a vendor or supplier.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the vendor."
        },
        "name": {
          "type": "string",
          "description": "The name of the vendor."
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the vendor."
        },
        "address": {
          "type": "string",
          "description": "The address of the vendor."
        },
        "openingBalance": {
          "type": "number",
          "description": "The vendor's opening balance."
        },
        "balanceType": {
          "type": "string",
          "enum": [
            "debit",
            "credit"
          ],
          "description": "The type of opening balance (debit or credit)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sales transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Sale)"
        },
        "itemId": {
          "type": "string",
          "description": "Reference to Item. (Relationship: Item 1:N Sale)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the item sold in this transaction."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the sale."
        },
        "saleDate": {
          "type": "string",
          "description": "The date of the sale.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "customerId",
        "itemId",
        "quantity",
        "totalAmount",
        "saleDate"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense."
        },
        "expenseTitle": {
          "type": "string",
          "description": "The title of the expense."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "The date of the expense.",
          "format": "date-time"
        },
        "category": {
          "type": "string",
          "description": "The category of the expense (Labour, Transport, Electricity, Other)."
        }
      },
      "required": [
        "id",
        "expenseTitle",
        "amount",
        "date",
        "category"
      ]
    },
    "Estimate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Estimate",
      "type": "object",
      "description": "Represents a cost estimate or quotation for a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the estimate."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to the Customer this estimate is for."
        },
        "customerName": {
          "type": "string",
          "description": "The name of the customer."
        },
        "items": {
          "type": "array",
          "description": "A list of items included in the estimate.",
          "items": {
            "$ref": "#/backend/entities/SaleItem"
          }
        },
        "total": {
          "type": "number",
          "description": "The total estimated amount."
        },
        "date": {
          "type": "string",
          "description": "The date the estimate was created.",
          "format": "date-time"
        },
        "discount": {
          "type": "number",
          "description": "Overall discount percentage applied to the estimate."
        }
      },
      "required": [
        "id",
        "customerId",
        "customerName",
        "items",
        "total",
        "date"
      ]
    },
    "SaleItem": {
      "title": "Sale Item",
      "type": "object",
      "description": "Represents an item within a sale or estimate.",
      "properties": {
        "itemId": {
          "type": "string"
        },
        "itemName": {
          "type": "string"
        },
        "quantity": {
          "type": "number"
        },
        "price": {
          "type": "number"
        },
        "color": {
          "type": "string"
        },
        "weight": {
          "type": "number"
        },
        "thickness": {
          "type": "string"
        },
        "feet": {
          "type": "number"
        },
        "discount": {
          "type": "number"
        }
      },
      "required": [
        "itemId",
        "itemName",
        "quantity",
        "price",
        "color",
        "thickness"
      ]
    },
    "Labour": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Labour",
      "type": "object",
      "description": "Represents a labourer or employee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the labourer."
        },
        "name": {
          "type": "string",
          "description": "The name of the labourer."
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the labourer."
        },
        "address": {
          "type": "string",
          "description": "The address of the labourer."
        },
        "monthlySalary": {
          "type": "number",
          "description": "The monthly salary of the labourer."
        }
      },
      "required": [
        "id",
        "name",
        "monthlySalary"
      ]
    },
    "SalaryPayment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Salary Payment",
      "type": "object",
      "description": "Represents a salary payment record for a specific month.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the salary payment."
        },
        "month": {
          "type": "string",
          "description": "The month for which the salary is paid (e.g., 'January')."
        },
        "year": {
          "type": "number",
          "description": "The year for which the salary is paid (e.g., 2024)."
        },
        "date": {
          "type": "string",
          "description": "The date the payment was made.",
          "format": "date-time"
        },
        "labourers": {
          "type": "array",
          "description": "List of labourers included in this payment batch.",
          "items": {
            "$ref": "#/backend/entities/SalaryLabourer"
          }
        },
        "totalAmountPaid": {
          "type": "number",
          "description": "The total amount paid in this salary batch."
        }
      },
      "required": [
        "id",
        "month",
        "year",
        "date",
        "labourers",
        "totalAmountPaid"
      ]
    },
    "SalaryLabourer": {
      "title": "Salary Labourer",
      "type": "object",
      "description": "Represents the salary details for a single labourer within a payment.",
      "properties": {
        "labourerId": {
          "type": "string"
        },
        "labourerName": {
          "type": "string"
        },
        "daysWorked": {
          "type": "number"
        },
        "monthlySalary": {
          "type": "number"
        },
        "overtimeHours": {
          "type": "number"
        },
        "overtimeRate": {
          "type": "number",
          "description": "The hourly rate for overtime work."
        },
        "deductions": {
          "type": "number"
        },
        "totalPayable": {
          "type": "number"
        }
      },
      "required": [
        "labourerId",
        "labourerName",
        "daysWorked",
        "monthlySalary",
        "totalPayable"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "role_admin",
          "schema": {
            "$ref": "#/backend/entities/role_admin"
          },
          "description": "Grants admin access to the user. The existence of a document indicates admin role.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the administrator."
            }
          ]
        }
      },
      {
        "path": "/items/{itemId}",
        "definition": {
          "entityName": "item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "Stores item information.",
          "params": [
            {
              "name": "itemId",
              "description": "Unique identifier for the item."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer information.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/vendors/{vendorId}",
        "definition": {
          "entityName": "vendor",
          "schema": {
            "$ref": "#/backend/entities/Vendor"
          },
          "description": "Stores vendor information.",
          "params": [
            {
              "name": "vendorId",
              "description": "Unique identifier for the vendor."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sales transaction information.",
          "params": [
            {
              "name": "saleId",
              "description": "Unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/expenses/{expenseId}",
        "definition": {
          "entityName": "expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense information.",
          "params": [
            {
              "name": "expenseId",
              "description": "Unique identifier for the expense."
            }
          ]
        }
      },
      {
        "path": "/estimates/{estimateId}",
        "definition": {
          "entityName": "estimate",
          "schema": {
            "$ref": "#/backend/entities/Estimate"
          },
          "description": "Stores estimate/quotation information.",
          "params": [
            {
              "name": "estimateId",
              "description": "Unique identifier for the estimate."
            }
          ]
        }
      },
      {
        "path": "/labour/{labourId}",
        "definition": {
          "entityName": "labour",
          "schema": {
            "$ref": "#/backend/entities/Labour"
          },
          "description": "Stores labourer information.",
          "params": [
            {
              "name": "labourId",
              "description": "Unique identifier for the labourer."
            }
          ]
        }
      },
      {
        "path": "/salaryPayments/{paymentId}",
        "definition": {
          "entityName": "salaryPayment",
          "schema": {
            "$ref": "#/backend/entities/SalaryPayment"
          },
          "description": "Stores salary payment records.",
          "params": [
            {
              "name": "paymentId",
              "description": "Unique identifier for the salary payment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage an aluminium factory's stock, sales, expenses, and customer data securely and efficiently. It prioritizes authorization independence to ensure robust security rules and scalable operations. The structure includes separate collections for `items`, `customers`, `vendors`, `sales`, `expenses`, and `estimates`, each serving distinct functions. To enforce admin-only access, a dedicated `/roles_admin/{uid}` collection is used; the existence of a document at this path grants admin privileges. This existence check is secure and efficient.\n\n**Authorization Independence and QAPs:**\n\n*   **Admin Role:** Authorization is handled via the existence of documents in the `/roles_admin/{uid}` collection. This avoids complex custom claims and enables straightforward security rules based solely on `request.auth.uid`.\n*   **Segregation:** The segregation of data into separate collections ensures that each collection has a homogeneous security posture, simplifying security rule definitions.\n\nThis structure adheres to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs, ensuring a secure, scalable, and debuggable Firestore design."
  }
}
